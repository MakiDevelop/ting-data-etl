# Agents 協作規則摘要

> 本文件為 CLAUDE.md 四方協作準則的快速參考摘要

---

## 角色定義

| 角色 | 定位 | 核心職責 |
|------|------|----------|
| **Human** | 最終決策者 | 定義需求、審核 diff、執行 commit、擁有 veto 權 |
| **Claude** | 總指揮 / Orchestrator | 任務拆解、架構設計、整合輸出、調度 Gemini/Codex |
| **Gemini** | 技術顧問 | 查詢文檔、解讀錯誤、風險評估、技術選型建議 |
| **Codex** | 實作專家 | 撰寫 production-ready code、code review、測試與 edge case |

---

## 協作規則

### Claude 必須遵守

| 規則 | 說明 |
|------|------|
| **先拆解再動手** | 收到需求後，先分解任務再實作 |
| **預設諮詢 Codex** | 非 trivial 實作、多檔案修改、商業邏輯必須諮詢 |
| **Gemini 用於不確定情境** | 最新 API、複雜錯誤、技術選型時呼叫 |
| **同一問題不超過 2 次嘗試** | 卡關必須回報，不硬衝 |
| **Gemini 輸出視為未驗證** | 必須整合後交人類裁決 |

### Gemini 限制

- **僅為顧問，不是實作者**
- 輸出一律視為「未驗證意見」
- 禁止直接依其回覆大幅修改程式碼
- **Pro 方案有每日額度**：達上限後立即停止呼叫，改用 Codex 或人類判斷

### Codex 限制

- 不做大型跨模組重構
- 每次輸出必須可 rollback
- 不引入未核准的新技術或假設

---

## 標準開發循環

```
1. Human 定義需求 → 成功標準、紅線
2. Claude 拆解任務 → 影響檔案、優先順序、風險標註
3. 諮詢 Gemini（如需）→ 技術不確定時
4. 預設諮詢 Codex → 實作與 review
5. Human 審核決策 → review diff、執行測試、commit
```

---

## 特殊條款

### 暫時繞過阻礙（Human 特權）

- 允許使用 mock / fake / replay 繞過 DB 或外部依賴
- 必須標記 `TODO` / `FIXME`
- 任務清單必須包含「恢復真實實作」

### 失控保護（強制暫停協作）

以下情況必須立即暫停 AI 協作：

- AI 之間結論衝突且無法歸因
- Codex 執行跨層/跨模組修改
- Gemini 資訊無法被官方文檔或實測驗證

### 不啟用四方模式的情境

- 緊急生產環境修復
- 支付/安全/合規核心邏輯
- 單檔案、低風險、50 行以下修改

---

## Decision Log 規則

- **檔案位置**：`docs/decision-log.md`
- **必須記錄**：
  - 選擇 mock / fake / replay 而非真實系統
  - 否決任何 AI（Claude / Gemini / Codex）建議
  - 技術選型、架構取捨、有明顯 trade-off 的決策
  - 為推進進度暫時接受「不完美方案」
- **Claude 必須主動提醒是否需要記錄**

---

## 人類優先指令（高優先覆寫）

當人類發出以下類型指令時，Agents 必須立即調整策略：

- 「這個先不修」
- 「現在只驗證 flow / state / UI」
- 「先 dump 成 JSON / mock 掉」

這些指令優先於技術正確性。

---

*最後更新：2026-01-21*
